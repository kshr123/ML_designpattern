# ==============================================================================
# Service定義
# ==============================================================================
# Serviceは、Podへのネットワークアクセスを提供する
#
# 【役割】
#   1. 複数のPodを1つのIPアドレスで公開
#   2. 負荷分散（複数のPodにリクエストを振り分け）
#   3. サービスディスカバリ（Pod のIPが変わっても同じ名前でアクセス可能）
#
# 【Service Type】
#   - ClusterIP: クラスタ内部からのみアクセス可能（デフォルト）
#   - NodePort: 各ノードのポートを公開
#   - LoadBalancer: 外部ロードバランサーを作成（クラウド環境）
#   - ExternalName: 外部サービスへのエイリアス
# ==============================================================================

apiVersion: v1
kind: Service
metadata:
  name: model-load-pattern-service
  namespace: model-load-pattern  # このServiceが属する名前空間
  labels:
    app: model-load-pattern

spec:
  # ----------------------------------------------------------------------------
  # Service Type
  # ----------------------------------------------------------------------------
  # LoadBalancer: 外部からアクセス可能にする
  # minikubeでは `minikube service` コマンドでアクセス
  # ----------------------------------------------------------------------------
  type: LoadBalancer

  # ----------------------------------------------------------------------------
  # Ports（ポート設定）
  # ----------------------------------------------------------------------------
  ports:
    - name: http
      port: 8000          # Service が公開するポート（外部からアクセスするポート）
      targetPort: 8000    # Pod のコンテナが listen しているポート
      protocol: TCP

  # ----------------------------------------------------------------------------
  # Selector（どのPodにトラフィックを送るか）
  # ----------------------------------------------------------------------------
  # このラベルを持つPodにトラフィックを振り分ける
  # Deployment で定義した Pod のラベルと一致させる
  # ----------------------------------------------------------------------------
  selector:
    app: model-load-pattern
