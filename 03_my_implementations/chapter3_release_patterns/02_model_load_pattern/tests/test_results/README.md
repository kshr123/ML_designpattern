# テスト結果の読み方

このディレクトリにはpytestの実行結果が保存されています。

## 📖 pytest出力の読み方

### テスト実行結果の見方

```
tests/test_api.py::TestHealthEndpoint::test_health_check PASSED [  3%]
                   ↑                    ↑                  ↑       ↑
                ファイル名            クラス名         テスト名  結果  進捗
```

**構成要素の説明**:
- **ファイル名**: テストが定義されているファイル（例: `tests/test_api.py`）
- **クラス名**: テストクラス（例: `TestHealthEndpoint`）
- **テスト名**: 個別のテストメソッド（例: `test_health_check`）
- **結果**: テストの実行結果（PASSED, FAILED, SKIPPED, ERROR）
- **進捗**: 全体のテスト進捗率（例: [  3%]）

### 結果の種類

- **PASSED** ✅ - テスト成功
  - テストケースが期待通りに動作した
  - すべてのアサーションが通過した

- **FAILED** ❌ - テスト失敗
  - アサーションが失敗した
  - 期待値と実際の値が一致しなかった
  - テスト下部に詳細なエラー情報が表示される

- **SKIPPED** ⏭️ - テストスキップ
  - `@pytest.mark.skip` でスキップされた
  - 条件付きスキップ（`@pytest.mark.skipif`）が適用された

- **ERROR** 💥 - テスト実行時エラー
  - テストコード自体にエラーがある
  - セットアップ/ティアダウンで例外が発生した

### サマリーの読み方

テスト実行の最後に表示されるサマリー:

```
======================== 28 passed in 0.77s =========================
                         ↑         ↑
                      成功数    実行時間
```

失敗がある場合:
```
======================== 4 failed, 25 passed in 2.21s =========================
                         ↑        ↑             ↑
                      失敗数    成功数      実行時間
```

### カバレッジレポートの読み方

`--cov` オプションを使用すると、コードカバレッジレポートが表示されます:

```
Name                    Stmts   Miss  Cover
-------------------------------------------
src/__init__.py             0      0   100%
src/configurations.py      13      0   100%
src/main.py                23      0   100%
src/ml/__init__.py          0      0   100%
src/ml/prediction.py       42      0   100%
-------------------------------------------
TOTAL                      78      0   100%
```

**カラムの説明**:
- **Name**: ファイル名
- **Stmts**: 実行可能な文の総数
- **Miss**: テストでカバーされなかった文の数
- **Cover**: カバレッジ率（%）

**カバレッジの目標**:
- 80%以上: 良好
- 90%以上: 優秀
- 100%: 完璧（ただし、すべてのエッジケースをカバーしているとは限らない）

### 失敗テストの詳細情報

失敗したテストの詳細は `=== FAILURES ===` セクションに表示されます:

```
=================================== FAILURES ===================================
______________ TestPredictEndpoint.test_predict_with_invalid_data ______________
tests/test_api.py:119: in test_predict_with_invalid_data
    response = client.post("/predict", json=payload)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
```

**読み方**:
1. **テスト名**: どのテストが失敗したか
2. **ファイル名:行番号**: エラーが発生した場所
3. **コードスニペット**: 失敗した行のコード
4. **エラーメッセージ**: 詳細なエラー内容（スタックトレースを含む）

### TDDサイクルにおけるテスト結果

このプロジェクトではTDD（テスト駆動開発）を採用しています:

1. **Red Phase** (`*_red.txt`):
   - テストを先に書き、実装がない状態で実行
   - すべてのテストが失敗する（期待通り）
   - エラーメッセージから必要な実装を理解する

2. **Green Phase** (`*_green.txt`):
   - 実装を完了し、テストを実行
   - すべてのテストが成功する
   - カバレッジレポートで実装の網羅性を確認

3. **Refactor Phase**:
   - テストを保ちながらコードを改善
   - リファクタリング後もテストが通ることを確認

## 📁 このディレクトリのファイル

- `README.md` (このファイル) - pytest出力の読み方ガイド
- `full_test_results.txt` - 全テストの実行結果
- `*_red.txt` - TDD Red Phaseの結果（テスト失敗フェーズ）
- `*_green.txt` - TDD Green Phaseの結果（テスト成功フェーズ）

## 🔄 テスト結果の再生成

テスト結果は再生成可能なため、Gitで管理していません。
ローカル環境で以下のコマンドで再生成できます:

```bash
# 全テスト実行
pytest tests/ -v > tests/test_results/full_test_results.txt 2>&1

# カバレッジ付き実行
pytest tests/ -v --cov=src --cov-report=html > tests/test_results/full_test_with_coverage.txt 2>&1

# 特定モジュールのテスト
pytest tests/test_api.py -v > tests/test_results/api_test_results.txt 2>&1
```

## 💡 ヒント

- テスト失敗時は、まず `=== FAILURES ===` セクションを確認
- カバレッジが低い場合は、テストケースの追加を検討
- `-v` オプションで詳細な出力、`-vv` でさらに詳細な出力
- `--lf` オプションで最後に失敗したテストのみ再実行
- `--tb=short` でスタックトレースを短縮表示
