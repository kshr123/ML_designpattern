################################################################################
# pytest 全テスト実行結果（TDD Green Phase）
################################################################################
#
# 実行日時: 2025-11-06 07:50
# 実行コマンド: pytest tests/ -v
# Python: 3.13.9
# pytest: 8.4.2
# プロジェクト: Model-in-Image Pattern (Chapter 3)
#
# このファイルの読み方は tests/test_results/README.md を参照してください
#
################################################################################

============================= test session starts ==============================
platform darwin -- Python 3.13.9, pytest-8.4.2, pluggy-1.6.0 -- /Users/kotaro/Desktop/dev/ML_designpattern/03_my_implementations/chapter3_release_patterns/01_model_in_image/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /Users/kotaro/Desktop/dev/ML_designpattern/03_my_implementations/chapter3_release_patterns/01_model_in_image
configfile: pyproject.toml
plugins: anyio-4.11.0, cov-7.0.0
collecting ... collected 38 items

tests/test_api.py::TestHealthEndpoint::test_health_check PASSED          [  2%]
tests/test_api.py::TestHealthEndpoint::test_health_check_method_not_allowed PASSED [  5%]
tests/test_api.py::TestMetadataEndpoint::test_metadata PASSED            [  7%]
tests/test_api.py::TestLabelEndpoint::test_get_labels PASSED             [ 10%]
tests/test_api.py::TestPredictTestEndpoint::test_predict_test PASSED     [ 13%]
tests/test_api.py::TestPredictTestEndpoint::test_predict_test_label PASSED [ 15%]
tests/test_api.py::TestPredictEndpoint::test_predict_setosa PASSED       [ 18%]
tests/test_api.py::TestPredictEndpoint::test_predict_versicolor PASSED   [ 21%]
tests/test_api.py::TestPredictEndpoint::test_predict_virginica PASSED    [ 23%]
tests/test_api.py::TestPredictEndpoint::test_predict_label_setosa PASSED [ 26%]
tests/test_api.py::TestPredictEndpoint::test_predict_label_versicolor PASSED [ 28%]
tests/test_api.py::TestPredictEndpoint::test_predict_label_virginica PASSED [ 31%]
tests/test_api.py::TestPredictEndpoint::test_predict_invalid_data_missing_field PASSED [ 34%]
tests/test_api.py::TestPredictEndpoint::test_predict_invalid_data_wrong_type PASSED [ 36%]
tests/test_api.py::TestPredictEndpoint::test_predict_invalid_data_wrong_shape PASSED [ 39%]
tests/test_api.py::TestPredictEndpoint::test_predict_empty_data PASSED   [ 42%]
tests/test_api.py::TestPredictEndpoint::test_predict_method_not_allowed PASSED [ 44%]
tests/test_api.py::TestRootEndpoint::test_root_redirect_or_docs PASSED   [ 47%]
tests/test_api.py::TestRootEndpoint::test_docs_endpoint PASSED           [ 50%]
tests/test_api.py::TestRootEndpoint::test_openapi_json PASSED            [ 52%]
tests/test_prediction.py::TestData::test_data_model_default PASSED       [ 55%]
tests/test_prediction.py::TestData::test_data_model_custom PASSED        [ 57%]
tests/test_prediction.py::TestClassifier::test_classifier_initialization PASSED [ 60%]
tests/test_prediction.py::TestClassifier::test_load_model PASSED         [ 63%]
tests/test_prediction.py::TestClassifier::test_load_label PASSED         [ 65%]
tests/test_prediction.py::TestClassifier::test_predict_shape PASSED      [ 68%]
tests/test_prediction.py::TestClassifier::test_predict_probability_range PASSED [ 71%]
tests/test_prediction.py::TestClassifier::test_predict_setosa PASSED     [ 73%]
tests/test_prediction.py::TestClassifier::test_predict_versicolor PASSED [ 76%]
tests/test_prediction.py::TestClassifier::test_predict_virginica PASSED  [ 78%]
tests/test_prediction.py::TestClassifier::test_predict_label_setosa PASSED [ 81%]
tests/test_prediction.py::TestClassifier::test_predict_label_versicolor PASSED [ 84%]
tests/test_prediction.py::TestClassifier::test_predict_label_virginica PASSED [ 86%]
tests/test_prediction.py::TestClassifier::test_predict_multiple_samples PASSED [ 89%]
tests/test_prediction.py::TestClassifier::test_predict_invalid_shape PASSED [ 92%]
tests/test_prediction.py::TestClassifier::test_predict_invalid_type PASSED [ 94%]
tests/test_prediction.py::TestClassifier::test_model_file_not_found PASSED [ 97%]
tests/test_prediction.py::TestClassifier::test_label_file_not_found PASSED [100%]

================================ tests coverage ================================
_______________ coverage: platform darwin, python 3.13.9-final-0 _______________

Name                               Stmts   Miss  Cover
------------------------------------------------------
src/model_in_image/__init__.py         0      0   100%
src/model_in_image/app.py             88     33    62%
src/model_in_image/prediction.py      75     17    77%
------------------------------------------------------
TOTAL                                163     50    69%
Coverage HTML written to dir htmlcov
============================== 38 passed in 0.87s ==============================


################################################################################
# テスト結果サマリー
################################################################################
#
# 総テスト数: 38
# 成功: 38 (100%)
# 失敗: 0 (0%)
# 実行時間: 0.87秒
#
# 【成功したテストモジュール】
# ✅ test_api.py                - 20/20 passed (FastAPI エンドポイントテスト)
# ✅ test_prediction.py         - 18/18 passed (推論ロジックテスト)
#
# 【テストカバレッジ】
# 総合カバレッジ: 69% (163行中113行をカバー)
#
# モジュール別カバレッジ:
#   - src/model_in_image/__init__.py:   100% (0/0)
#   - src/model_in_image/app.py:        62%  (88行中55行)
#   - src/model_in_image/prediction.py: 77%  (75行中58行)
#
# 【カバレッジ分析】
# ⚠️ app.py (62%):
#   - startup/shutdownイベントのテストが不足
#   - エラーハンドリングの一部がカバーされていない
#
# ⚠️ prediction.py (77%):
#   - 一部のエラーパスがカバーされていない
#   - モデルファイルの異常系テストが不足
#
# 【総合評価】
# ✅ 全テストケースが成功
# ✅ 実行時間は非常に高速（1秒未満）
# ⚠️ カバレッジは69%で目標の80%に未達（改善の余地あり）
# ✅ 主要な機能（推論、API）は十分にテストされている
#
# 【デプロイメント検証結果】
# ✅ Kubernetes デプロイメント成功（2 replicas）
# ✅ すべてのIris品種で正しい推論結果
#   - Setosa: "setosa" ✓
#   - Versicolor: "versicolor" ✓
#   - Virginica: "virginica" ✓
# ✅ ヘルスチェックエンドポイント動作確認
#
# 【TDDサイクル完了】
# Red（失敗）→ Green（成功）→ Refactor（今後）
#
################################################################################
