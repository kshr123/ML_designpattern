# Docker & Kubernetes å…¥é–€ã‚¬ã‚¤ãƒ‰

**ä½œæˆæ—¥**: 2025-11-06
**å¯¾è±¡**: Dockerãƒ»Kubernetesåˆå¿ƒè€…
**ç›®çš„**: æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã¨Kubernetesãƒ‡ãƒ—ãƒ­ã‚¤ã®åŸºç¤ã‚’ç†è§£ã™ã‚‹

---

## ğŸ“š ç›®æ¬¡

1. [ãªãœDockerã¨KubernetesãŒå¿…è¦ãªã®ã‹](#ãªãœdockerã¨kubernetesãŒå¿…è¦ãªã®ã‹)
2. [Dockerã®åŸºç¤](#dockerã®åŸºç¤)
3. [Kubernetesã®åŸºç¤](#kubernetesã®åŸºç¤)
4. [å®Ÿè·µï¼šModel-in-Image Pattern](#å®Ÿè·µmodel-in-image-pattern)
5. [ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã¨è§£æ±ºæ–¹æ³•](#ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã¨è§£æ±ºæ–¹æ³•)
6. [æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—](#æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—)

---

## ãªãœDockerã¨KubernetesãŒå¿…è¦ãªã®ã‹

### å¾“æ¥ã®å•é¡Œ

æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹éš›ã®èª²é¡Œï¼š

1. **ç’°å¢ƒã®é•ã„**
   - é–‹ç™ºç’°å¢ƒã§ã¯å‹•ããŒã€æœ¬ç•ªç’°å¢ƒã§å‹•ã‹ãªã„
   - Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä¸ä¸€è‡´
   - ã€Œç§ã®ç’°å¢ƒã§ã¯å‹•ãã®ã«...ã€å•é¡Œ

2. **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®å›°é›£ã•**
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¢—ãˆãŸã‚‰æ‰‹å‹•ã§ã‚µãƒ¼ãƒãƒ¼ã‚’è¿½åŠ 
   - è² è·åˆ†æ•£ã®è¨­å®šãŒè¤‡é›‘
   - éšœå®³æ™‚ã®è‡ªå‹•å¾©æ—§ãŒã§ããªã„

3. **ãƒ‡ãƒ—ãƒ­ã‚¤ã®æ‰‹é–“**
   - ãƒ¢ãƒ‡ãƒ«æ›´æ–°ã®ãŸã³ã«å…¨ã‚µãƒ¼ãƒãƒ¼ã§æ‰‹ä½œæ¥­
   - ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿ
   - ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå›°é›£

### Dockerã¨Kubernetesã§è§£æ±º

- **Docker**: ã€Œã©ã“ã§ã‚‚åŒã˜ã‚ˆã†ã«å‹•ãç’°å¢ƒã€ã‚’ä½œã‚‹
- **Kubernetes**: ã€Œè‡ªå‹•ã§ã‚¹ã‚±ãƒ¼ãƒ«ãƒ»å¾©æ—§ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚’ç®¡ç†

---

## Dockerã®åŸºç¤

### Dockerã¨ã¯

**ã‚³ãƒ³ãƒ†ãƒŠæŠ€è¡“ã‚’ä½¿ã£ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãã®å®Ÿè¡Œç’°å¢ƒã‚’1ã¤ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¾ã¨ã‚ã‚‹ä»•çµ„ã¿**

#### é‡è¦ãªæ¦‚å¿µ

| ç”¨èª | èª¬æ˜ | ä¾‹ãˆ |
|------|------|------|
| **ã‚¤ãƒ¡ãƒ¼ã‚¸** | ã‚¢ãƒ—ãƒªã¨ç’°å¢ƒã®è¨­è¨ˆå›³ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰ | ã‚¯ãƒƒã‚­ãƒ¼ã®å‹ |
| **ã‚³ãƒ³ãƒ†ãƒŠ** | ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ä½œã‚‰ã‚ŒãŸå®Ÿè¡Œç’°å¢ƒ | å‹ã‹ã‚‰ä½œã£ãŸã‚¯ãƒƒã‚­ãƒ¼ |
| **Dockerfile** | ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œã‚Šæ–¹ã‚’æ›¸ã„ãŸãƒ¬ã‚·ãƒ” | æ–™ç†ã®ãƒ¬ã‚·ãƒ” |
| **ãƒ¬ã‚¸ã‚¹ãƒˆãƒª** | ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä¿ç®¡å ´æ‰€ | å›³æ›¸é¤¨ |

### Dockerã®åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

```bash
# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ï¼ˆè¨­è¨ˆå›³ã‚’ä½œã‚‹ï¼‰
docker build -t my-app:v1.0 .

# ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ï¼ˆè¨­è¨ˆå›³ã‹ã‚‰å®Ÿä½“ã‚’ä½œã£ã¦å‹•ã‹ã™ï¼‰
docker run -d --name my-container -p 8000:8000 my-app:v1.0

# èµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¢ºèª
docker ps

# ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ã‚’ç¢ºèª
docker logs my-container

# ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢
docker stop my-container

# ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤
docker rm my-container

# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç¢ºèª
docker images

# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å‰Šé™¤
docker rmi my-app:v1.0
```

### Dockerfileã®åŸºæœ¬æ§‹é€ 

```dockerfile
# ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆåœŸå°ã¨ãªã‚‹OS + è¨€èªç’°å¢ƒï¼‰
FROM python:3.13-slim

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®š
WORKDIR /app

# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
ENV PYTHONUNBUFFERED=1

# ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN apt-get update && apt-get install -y curl

# ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
COPY src/ ./src/

# ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆModel-in-Image Patternï¼‰
COPY models/ ./models/

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆã‚³ãƒ³ãƒ†ãƒŠãŒæ­£å¸¸ã‹ç¢ºèªï¼‰
HEALTHCHECK --interval=30s --timeout=10s \
    CMD curl -f http://localhost:8000/health || exit 1

# å…¬é–‹ã™ã‚‹ãƒãƒ¼ãƒˆ
EXPOSE 8000

# èµ·å‹•ã‚³ãƒãƒ³ãƒ‰
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8000"]
```

### Dockerã®åˆ©ç‚¹

âœ… **å†ç¾æ€§**: åŒã˜Dockerfileã‹ã‚‰åŒã˜ç’°å¢ƒãŒä½œã‚Œã‚‹
âœ… **è»½é‡**: ä»®æƒ³ãƒã‚·ãƒ³ã‚ˆã‚Šèµ·å‹•ãŒé€Ÿãã€ãƒªã‚½ãƒ¼ã‚¹æ¶ˆè²»ãŒå°‘ãªã„
âœ… **åˆ†é›¢**: è¤‡æ•°ã®ã‚¢ãƒ—ãƒªãŒäº’ã„ã«å¹²æ¸‰ã—ãªã„
âœ… **ç§»æ¤æ€§**: é–‹ç™ºâ†’ãƒ†ã‚¹ãƒˆâ†’æœ¬ç•ªã§åŒã˜ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ãˆã‚‹

---

## Kubernetesã®åŸºç¤

### Kubernetesã¨ã¯

**è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’è‡ªå‹•ã§ç®¡ç†ãƒ»é‹ç”¨ã™ã‚‹ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«**

ã€Œã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ©ã®æŒ‡æ®è€…ã€ã®ã‚ˆã†ã«ã€å¤šæ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èª¿æ•´ã—ã¦ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«å‹•ã‹ã™ã€‚

### Dockerã¨Kubernetesã®é–¢ä¿‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Kubernetes                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚         Pod                           â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚
â”‚  â”‚  â”‚    Dockerã‚³ãƒ³ãƒ†ãƒŠ           â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚  Dockerã‚¤ãƒ¡ãƒ¼ã‚¸      â”‚  â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ ã‚¢ãƒ—ãƒªã‚³ãƒ¼ãƒ‰     â”‚  â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«   â”‚  â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª   â”‚  â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å½¹å‰²åˆ†æ‹…**:
- **Docker**ï¼ˆã‚³ãƒ³ãƒ†ãƒŠæŠ€è¡“ï¼‰: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°**
  - Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ = ã‚¢ãƒ—ãƒª + ä¾å­˜é–¢ä¿‚ + ç’°å¢ƒ
  - ã‚³ãƒ³ãƒ†ãƒŠ = ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å®Ÿè¡Œã—ãŸçŠ¶æ…‹

- **Kubernetes**ï¼ˆã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰: Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’**ç®¡ç†ãƒ»é‹ç”¨**
  - è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¹ã‚±ãƒ¼ãƒ«ã€ç›£è¦–ã€å¾©æ—§

**æ¯”å–©**:
- Docker = å¼å½“ç®±ï¼ˆã‚¢ãƒ—ãƒªã‚’è©°ã‚ã‚‹ï¼‰
- Kubernetes = ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ï¼ˆå¼å½“ç®±ã‚’ç®¡ç†ãƒ»é…è†³ï¼‰

---

### Pod / Deployment / Service ã®é–¢ä¿‚

ã“ã®3ã¤ã®é–¢ä¿‚ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒã€Kubernetesã‚’ä½¿ã„ã“ãªã™éµã§ã™ã€‚

#### ğŸ“¦ Podï¼ˆãƒãƒƒãƒ‰ï¼‰ - æœ€å°å˜ä½ã®ã‚³ãƒ³ãƒ†ãƒŠã‚°ãƒ«ãƒ¼ãƒ—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pod                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ã‚³ãƒ³ãƒ†ãƒŠ1     â”‚  â”‚ â† é€šå¸¸ã¯1ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠ
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚
â”‚  ï¼ˆå¿…è¦ã«å¿œã˜ã¦     â”‚
â”‚   è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã‚‚å¯ï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹å¾´**:
- 1ã¤ä»¥ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠã®é›†ã¾ã‚Š
- åŒã˜IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…±æœ‰
- ä¸€ç·’ã«èµ·å‹•ãƒ»åœæ­¢ã•ã‚Œã‚‹
- **ä¸€æ™‚çš„ãªå­˜åœ¨**ï¼ˆå‰Šé™¤ã•ã‚Œã‚‹ã¨æ¶ˆãˆã‚‹ï¼‰

**ä¾‹**: Model-in-Imageã®å ´åˆã€1ã¤ã®Pod = 1ã¤ã®FastAPIã‚³ãƒ³ãƒ†ãƒŠ

---

#### ğŸ­ Deploymentï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆï¼‰ - Podã‚’ä½œæˆãƒ»ç®¡ç†ã™ã‚‹å·¥å ´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Deployment                            â”‚
â”‚  ã€Œå¸¸ã«2å€‹ã®Podã‚’ç¶­æŒã›ã‚ˆã€            â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Pod1 â”‚  â”‚ Pod2 â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                        â”‚
â”‚  ï¼ˆPod1ãŒæ­»ã‚“ã ã‚‰è‡ªå‹•ã§æ–°ã—ã„Podã‚’ä½œæˆï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å½¹å‰²**:
- Podã‚’**è‡ªå‹•çš„ã«ä½œæˆãƒ»å¾©æ—§**
- `replicas: 2` â†’ å¸¸ã«2å€‹ã®Podã‚’ç¶­æŒ
- PodãŒæ­»ã‚“ã ã‚‰è‡ªå‹•ã§å†èµ·å‹•
- ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼ˆç„¡åœæ­¢æ›´æ–°ï¼‰

**æ¯”å–©**: å·¥å ´ã®ç”Ÿç”£ãƒ©ã‚¤ãƒ³
- ã€Œå¸¸ã«2å€‹ã®è£½å“ã‚’ä½œã‚Šç¶šã‘ãªã•ã„ã€ã¨ã„ã†æŒ‡ç¤ºæ›¸
- è£½å“ï¼ˆPodï¼‰ãŒå£Šã‚ŒãŸã‚‰è‡ªå‹•ã§ä½œã‚Šç›´ã™

---

#### ğŸšª Serviceï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰ - Podã¸ã®ã‚¢ã‚¯ã‚»ã‚¹çª“å£ï¼ˆå—ä»˜ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service (å—ä»˜ãƒ»æ¡ˆå†…æ‰€)                  â”‚
â”‚  ã€Œapp=my-app ã¨ã„ã†ãƒ©ãƒ™ãƒ«ã®Podã«        â”‚
â”‚   ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’æŒ¯ã‚Šåˆ†ã‘ã¾ã™ã€           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
       â†“               â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”
   â”‚ Pod1 â”‚        â”‚ Pod2 â”‚
   â”‚app:  â”‚        â”‚app:  â”‚
   â”‚my-appâ”‚        â”‚my-appâ”‚
   â””â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”˜
```

**å½¹å‰²**:
- **å›ºå®šã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**ã‚’æä¾›ï¼ˆPodã®IPã¯å¤‰ã‚ã‚‹ãŒã€Serviceã®IPã¯å›ºå®šï¼‰
- è¤‡æ•°ã®Podã«**ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°**ï¼ˆãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ†æ•£ï¼‰
- **ãƒ©ãƒ™ãƒ«**ã§Podã‚’é¸æŠï¼ˆåå‰ã§ã¯ãªãå±æ€§ã§é¸ã¶ï¼‰

**é‡è¦**: Deploymentã¨Serviceã¯**ç–çµåˆ**
- Deployment: Podã‚’ä½œã‚‹ãƒ»ç®¡ç†ã™ã‚‹
- Service: ãƒ©ãƒ™ãƒ«ã§Podã‚’æ¢ã™ãƒ»æŒ¯ã‚Šåˆ†ã‘ã‚‹
- ãŠäº’ã„ç‹¬ç«‹ã—ã¦ã„ã‚‹ãŒã€ãƒ©ãƒ™ãƒ«ã§ã¤ãªãŒã‚‹

**æ¯”å–©**:
- Pod = ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã®å€‹å®¤ï¼ˆç•ªå·ãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§ã‚ã‚Šï¼‰
- Service = ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã®å—ä»˜ï¼ˆã€Œâ—‹â—‹æ§˜ã®ã”äºˆç´„ã¯ã“ã¡ã‚‰ã¸ã€ã¨æ¡ˆå†…ï¼‰

---

### å…¨ä½“ã®é–¢ä¿‚å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kubernetes Cluster                                    â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Deployment: model-in-image-deployment       â”‚     â”‚
â”‚  â”‚  - replicas: 2 ï¼ˆ2å€‹ã®Podã‚’ç¶­æŒï¼‰           â”‚     â”‚
â”‚  â”‚  - template:                                 â”‚     â”‚
â”‚  â”‚      labels: app=model-in-image              â”‚     â”‚
â”‚  â”‚                                              â”‚     â”‚
â”‚  â”‚  ä½œæˆãƒ»ç®¡ç†â†“                                â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”‚
â”‚  â”‚  â”‚ Pod1         â”‚  â”‚ Pod2         â”‚        â”‚     â”‚
â”‚  â”‚  â”‚ app=model... â”‚  â”‚ app=model... â”‚        â”‚     â”‚
â”‚  â”‚  â”‚ IP: å¤‰å‹•     â”‚  â”‚ IP: å¤‰å‹•     â”‚        â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Service: model-in-image-service             â”‚     â”‚
â”‚  â”‚  - selector: app=model-in-image              â”‚     â”‚
â”‚  â”‚  - type: NodePort                            â”‚     â”‚
â”‚  â”‚  - port: 8000 â†’ NodePort: 30080             â”‚     â”‚
â”‚  â”‚  - ClusterIP: å›ºå®š                           â”‚     â”‚
â”‚  â”‚                                              â”‚     â”‚
â”‚  â”‚  ãƒ©ãƒ™ãƒ«ã§é¸æŠâ†“                              â”‚     â”‚
â”‚  â”‚  Pod1ã¨Pod2ã«ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’æŒ¯ã‚Šåˆ†ã‘         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                        â”‚
â”‚                        â†‘                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                  å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹
              (http://localhost:30080)
```

### å®Ÿéš›ã®æµã‚Œ

**â‘  Deploymentã‚’ä½œæˆ**
```bash
kubectl apply -f deployment.yml
```
â†’ KubernetesãŒ2å€‹ã®Podã‚’è‡ªå‹•ä½œæˆ

**â‘¡ Serviceã‚’ä½œæˆ**
```bash
kubectl apply -f service.yml
```
â†’ ServiceãŒ`app=model-in-image`ãƒ©ãƒ™ãƒ«ã‚’æŒã¤Podã‚’æ¢ã—ã¦ç™»éŒ²

**â‘¢ ã‚¢ã‚¯ã‚»ã‚¹**
```bash
curl http://localhost:30080/predict
```
â†’ ServiceãŒ2ã¤ã®Podã®ã©ã¡ã‚‰ã‹ã«æŒ¯ã‚Šåˆ†ã‘ï¼ˆãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ï¼‰

**â‘£ ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ**
```bash
kubectl scale deployment --replicas=5
```
â†’ DeploymentãŒ3å€‹è¿½åŠ ã®Podã‚’ä½œæˆ
â†’ **ServiceãŒè‡ªå‹•çš„ã«5å€‹ã™ã¹ã¦ã‚’æ¤œå‡º**ï¼ˆãƒ©ãƒ™ãƒ«ãŒä¸€è‡´ã™ã‚‹ã‹ã‚‰ï¼‰

---

## Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’minikubeã«ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ç†ç”±

### Dockerã¨minikubeã¯åˆ¥ã®ç’°å¢ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚ãªãŸã®Macï¼ˆãƒ›ã‚¹ãƒˆï¼‰                            â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Docker Desktop                       â”‚      â”‚
â”‚  â”‚                                      â”‚      â”‚
â”‚  â”‚  ã‚¤ãƒ¡ãƒ¼ã‚¸ä¿å­˜å ´æ‰€                     â”‚      â”‚
â”‚  â”‚  - model-in-image-pattern:v1.0 âœ…   â”‚      â”‚
â”‚  â”‚  - nginx:alpine                     â”‚      â”‚
â”‚  â”‚  - redis:7-alpine                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ minikubeï¼ˆä»®æƒ³ãƒã‚·ãƒ³å†…ã®K8sï¼‰         â”‚      â”‚
â”‚  â”‚                                      â”‚      â”‚
â”‚  â”‚  ç‹¬ç«‹ã—ãŸDockerç’°å¢ƒ                  â”‚      â”‚
â”‚  â”‚  - ã‚¤ãƒ¡ãƒ¼ã‚¸ä¿å­˜å ´æ‰€ï¼ˆåˆ¥ç‰©ï¼ï¼‰        â”‚      â”‚
â”‚  â”‚  - æœ€åˆã¯ç©ºã£ã½ âŒ                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãªãœãƒ­ãƒ¼ãƒ‰ãŒå¿…è¦ã‹

**å•é¡Œ**: ãƒ›ã‚¹ãƒˆï¼ˆMacï¼‰ã§ãƒ“ãƒ«ãƒ‰ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã€minikubeå†…ã®Kubernetesã‹ã‚‰è¦‹ãˆãªã„

```bash
# Macä¸Šã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
docker build -t model-in-image-pattern:v1.0 .
# â†’ Docker Desktopã«ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒä¿å­˜ã•ã‚Œã‚‹

# Kubernetesã§ãƒ‡ãƒ—ãƒ­ã‚¤
kubectl apply -f k8s/deployment.yml
# â†’ minikubeãŒã€Œmodel-in-image-pattern:v1.0ã€ã‚’æ¢ã™
# â†’ minikubeå†…ã«ã¯ãªã„ï¼âŒ
# â†’ ã‚¨ãƒ©ãƒ¼: ImagePullBackOffï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„ï¼‰
```

**è§£æ±ºç­–**: ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’minikubeã«ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚³ãƒ”ãƒ¼ï¼‰ã™ã‚‹

```bash
minikube image load model-in-image-pattern:v1.0
```

**ä½•ãŒèµ·ãã‚‹ã‹**:
```
Docker Desktop                  minikube
     â†“                             â†“
[ã‚¤ãƒ¡ãƒ¼ã‚¸]  â”€â”€ãƒ­ãƒ¼ãƒ‰â†’  [ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚³ãƒ”ãƒ¼]
```

ã“ã‚Œã§ã€minikubeå†…ã®KubernetesãŒ `model-in-image-pattern:v1.0` ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

---

### ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’minikubeã«æ¸¡ã™3ã¤ã®æ–¹æ³•

#### æ–¹æ³•1: `minikube image load`ï¼ˆä»Šå›ä½¿ã†æ–¹æ³•ï¼‰

**ç‰¹å¾´**:
- ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’minikubeã«ã‚³ãƒ”ãƒ¼
- ç°¡å˜ã€é€Ÿã„
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸è¦

```bash
# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
docker build -t model-in-image-pattern:v1.0 .

# minikubeã«ãƒ­ãƒ¼ãƒ‰
minikube image load model-in-image-pattern:v1.0

# Kubernetesã«ãƒ‡ãƒ—ãƒ­ã‚¤
kubectl apply -f k8s/deployment.yml
```

#### æ–¹æ³•2: Docker RegistryçµŒç”±ï¼ˆDocker Hubç­‰ï¼‰

**ç‰¹å¾´**:
- ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’Docker Hubãªã©ã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥
- KubernetesãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆçµŒç”±ã§å–å¾—
- ãƒãƒ¼ãƒ å…±æœ‰ã‚„æœ¬ç•ªç’°å¢ƒå‘ã‘

```bash
# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ï¼†ã‚¿ã‚°ä»˜ã‘
docker build -t username/model-in-image-pattern:v1.0 .

# Docker Hubã«ãƒ—ãƒƒã‚·ãƒ¥
docker push username/model-in-image-pattern:v1.0

# deployment.ymlã§æŒ‡å®š
# image: username/model-in-image-pattern:v1.0

# Kubernetesã«ãƒ‡ãƒ—ãƒ­ã‚¤
kubectl apply -f k8s/deployment.yml
# â†’ KubernetesãŒDocker Hubã‹ã‚‰è‡ªå‹•å–å¾—
```

#### æ–¹æ³•3: minikubeã®Dockerç’°å¢ƒã§ç›´æ¥ãƒ“ãƒ«ãƒ‰

**ç‰¹å¾´**:
- minikubeå†…ã®Dockerã‚’ä½¿ã£ã¦ãƒ“ãƒ«ãƒ‰
- ãƒ­ãƒ¼ãƒ‰ä¸è¦ï¼ˆæœ€åˆã‹ã‚‰minikubeå†…ã«ã‚ã‚‹ï¼‰
- å°‘ã—è¤‡é›‘

```bash
# minikubeã®Dockerç’°å¢ƒã‚’ä½¿ç”¨
eval $(minikube docker-env)

# ã“ã®çŠ¶æ…‹ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã€minikubeå†…ã«ä¿å­˜ã•ã‚Œã‚‹
docker build -t model-in-image-pattern:v1.0 .

# Kubernetesã«ãƒ‡ãƒ—ãƒ­ã‚¤
kubectl apply -f k8s/deployment.yml

# å…ƒã®ç’°å¢ƒã«æˆ»ã™
eval $(minikube docker-env -u)
```

---

### ã¾ã¨ã‚

| æ–¹æ³• | ç”¨é€” | ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ |
|------|------|----------|-----------|
| `minikube image load` | ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º | ç°¡å˜ã€é€Ÿã„ | minikubeå°‚ç”¨ |
| Docker Registry | æœ¬ç•ªç’°å¢ƒã€ãƒãƒ¼ãƒ å…±æœ‰ | æ¨™æº–çš„ã€å…±æœ‰å¯èƒ½ | ãƒ¬ã‚¸ã‚¹ãƒˆãƒªè¨­å®šãŒå¿…è¦ |
| minikube Dockerç’°å¢ƒ | é«˜åº¦ãªé–‹ç™º | ãƒ­ãƒ¼ãƒ‰ä¸è¦ | ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆãŒå¿…è¦ |

**åˆå¿ƒè€…å‘ã‘**: æ–¹æ³•1ï¼ˆ`minikube image load`ï¼‰ãŒãŠã™ã™ã‚ï¼

---

#### 4. **Namespaceï¼ˆãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ï¼‰**
- ãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹è«–ç†çš„ãªåŒºåˆ‡ã‚Š
- ç’°å¢ƒï¼ˆdev, staging, prodï¼‰ã‚„ãƒãƒ¼ãƒ å˜ä½ã§åˆ†ã‘ã‚‹

#### 5. **HPAï¼ˆHorizontal Pod Autoscalerï¼‰**
- è² è·ã«å¿œã˜ã¦Podæ•°ã‚’è‡ªå‹•èª¿æ•´
- CPU/ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ã§åˆ¤æ–­

```
è² è·ãŒé«˜ã„ â†’ Podæ•°ã‚’å¢—ã‚„ã™ï¼ˆã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆï¼‰
è² è·ãŒä½ã„ â†’ Podæ•°ã‚’æ¸›ã‚‰ã™ï¼ˆã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ï¼‰
```

### Kubernetesã®åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’é©ç”¨ï¼ˆãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆãƒ»æ›´æ–°ï¼‰
kubectl apply -f deployment.yml

# ãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèª
kubectl get pods -n my-namespace
kubectl get deployments -n my-namespace
kubectl get services -n my-namespace

# è©³ç´°æƒ…å ±ã‚’ç¢ºèª
kubectl describe pod my-pod -n my-namespace

# ãƒ­ã‚°ã‚’ç¢ºèª
kubectl logs my-pod -n my-namespace

# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
kubectl exec -it my-pod -n my-namespace -- /bin/bash

# ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤
kubectl delete -f deployment.yml
kubectl delete pod my-pod -n my-namespace
```

### ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆYAMLï¼‰

Kubernetesã¸ã®æŒ‡ç¤ºæ›¸ã€‚ä½•ã‚’ã€ã©ã†å‹•ã‹ã™ã‹ã‚’å®£è¨€çš„ã«è¨˜è¿°ã€‚

**ä¾‹: Deployment**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
  namespace: my-namespace
spec:
  replicas: 3  # Podæ•°
  selector:
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
      - name: my-container
        image: my-app:v1.0
        ports:
        - containerPort: 8000
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
```

---

## å®Ÿè·µï¼šModel-in-Image Pattern

### ãƒ‘ã‚¿ãƒ¼ãƒ³æ¦‚è¦

**å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã‚ã¦é…å¸ƒã™ã‚‹æ–¹å¼**

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… ãƒ‡ãƒ—ãƒ­ã‚¤ãŒç°¡å˜ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’Pullã™ã‚‹ã ã‘ï¼‰
- âœ… ãƒ¢ãƒ‡ãƒ«ã¨ã‚³ãƒ¼ãƒ‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸€è‡´
- âœ… é«˜é€Ÿèµ·å‹•ï¼ˆãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸è¦ï¼‰

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ ãƒ¢ãƒ‡ãƒ«æ›´æ–°ã®ãŸã³ã«ã‚¤ãƒ¡ãƒ¼ã‚¸å†ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦
- âŒ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºãŒå¤§ãããªã‚‹
- âŒ è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã®ç®¡ç†ãŒç…©é›‘

### å®Ÿè£…ã®æµã‚Œ

#### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
01_model_in_image/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ model_in_image/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ app.py           # FastAPIã‚¢ãƒ—ãƒª
â”‚       â””â”€â”€ prediction.py    # æ¨è«–ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ iris_svc.onnx        # å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ label.json           # ãƒ©ãƒ™ãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_prediction.py   # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ test_api.py          # çµ±åˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ k8s/
â”‚   â”œâ”€â”€ namespace.yml        # Namespaceå®šç¾©
â”‚   â”œâ”€â”€ deployment.yml       # Deploymentå®šç¾©
â”‚   â”œâ”€â”€ service.yml          # Serviceå®šç¾©
â”‚   â””â”€â”€ hpa.yml              # HPAå®šç¾©
â”œâ”€â”€ Dockerfile               # ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰æ‰‹é †
â”œâ”€â”€ run.sh                   # èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ pyproject.toml           # ä¾å­˜é–¢ä¿‚
â””â”€â”€ SPECIFICATION.md         # ä»•æ§˜æ›¸
```

#### 2. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰

```bash
# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
docker build -t model-in-image-pattern:v1.0 .

# ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆ
docker run -d --name test -p 8000:8000 model-in-image-pattern:v1.0

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8000/health

# æ¨è«–ãƒ†ã‚¹ãƒˆ
curl -X POST http://localhost:8000/predict \
  -H "Content-Type: application/json" \
  -d '{"data": [[5.1, 3.5, 1.4, 0.2]]}'

# ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
docker stop test && docker rm test
```

#### 3. minikubeã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# minikubeèµ·å‹•
minikube start

# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’minikubeã«ãƒ­ãƒ¼ãƒ‰
minikube image load model-in-image-pattern:v1.0

# Namespaceã‚’ä½œæˆ
kubectl apply -f k8s/namespace.yml

# Deploymentã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
kubectl apply -f k8s/deployment.yml

# Serviceã‚’ä½œæˆ
kubectl apply -f k8s/service.yml

# HPAï¼ˆã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼‰ã‚’è¨­å®š
kubectl apply -f k8s/hpa.yml

# çŠ¶æ…‹ã‚’ç¢ºèª
kubectl get all -n model-in-image

# Podã®ãƒ­ã‚°ã‚’ç¢ºèª
kubectl logs -f deployment/model-in-image-deployment -n model-in-image

# ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹
minikube service model-in-image-service -n model-in-image
```

#### 4. å‹•ä½œç¢ºèª

```bash
# minikubeã®IPã¨ãƒãƒ¼ãƒˆã‚’å–å¾—
minikube service model-in-image-service -n model-in-image --url

# ä¾‹: http://192.168.49.2:30080

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://192.168.49.2:30080/health

# ãƒ©ãƒ™ãƒ«å–å¾—
curl http://192.168.49.2:30080/label

# æ¨è«–å®Ÿè¡Œ
curl -X POST http://192.168.49.2:30080/predict \
  -H "Content-Type: application/json" \
  -d '{"data": [[5.1, 3.5, 1.4, 0.2]]}'
```

---

## ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã¨è§£æ±ºæ–¹æ³•

### Dockeré–¢é€£

#### âŒ å•é¡Œ: `ModuleNotFoundError: No module named 'xxx'`

**åŸå› **: Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ‘ã‚¹ãŒé€šã£ã¦ã„ãªã„

**è§£æ±ºç­–**:
```dockerfile
# Dockerfileã«è¿½åŠ 
ENV PYTHONPATH=/app/src
```

#### âŒ å•é¡Œ: ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã‚‹

**è§£æ±ºç­–**:
1. ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã‚’ä½¿ã†
2. `.dockerignore`ã§ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
3. `--no-cache-dir`ã§pipã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤

```dockerfile
# ä¾‹
RUN pip install --no-cache-dir -r requirements.txt
```

#### âŒ å•é¡Œ: ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã™ãçµ‚äº†ã™ã‚‹

**ç¢ºèªæ–¹æ³•**:
```bash
docker logs <container-id>
```

**ã‚ˆãã‚ã‚‹åŸå› **:
- èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã®èª¤ã‚Š
- å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒCOPYã•ã‚Œã¦ã„ãªã„
- ãƒãƒ¼ãƒˆã®è¨­å®šãƒŸã‚¹

### Kubernetesé–¢é€£

#### âŒ å•é¡Œ: Pod ãŒ `ImagePullBackOff` ã‚¨ãƒ©ãƒ¼

**åŸå› **: ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**è§£æ±ºç­–**:
```bash
# minikubeã®å ´åˆ
minikube image load my-image:v1.0

# Deploymentã§æŒ‡å®š
imagePullPolicy: Never  # ãƒ­ãƒ¼ã‚«ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨
```

#### âŒ å•é¡Œ: Pod ãŒ `CrashLoopBackOff`

**åŸå› **: ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ç›´å¾Œã«ã‚¯ãƒ©ãƒƒã‚·ãƒ¥

**ç¢ºèªæ–¹æ³•**:
```bash
kubectl logs <pod-name> -n <namespace>
kubectl describe pod <pod-name> -n <namespace>
```

#### âŒ å•é¡Œ: Service ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„

**ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:
1. Service ã® selector ãŒ Pod ã® label ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹
2. targetPort ãŒæ­£ã—ã„ã‹
3. NetworkPolicy ã§åˆ¶é™ã•ã‚Œã¦ã„ãªã„ã‹

```bash
# Serviceç¢ºèª
kubectl describe service <service-name> -n <namespace>

# EndpointsãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
kubectl get endpoints <service-name> -n <namespace>
```

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹

1. **Docker**
   - å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: https://docs.docker.com/
   - Docker Hub: https://hub.docker.com/

2. **Kubernetes**
   - å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«: https://kubernetes.io/ja/docs/tutorials/
   - Kubernetes By Example: https://kubernetesbyexample.com/

3. **å®Ÿè·µ**
   - æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è©¦ã™
   - æœ¬ç•ªç’°å¢ƒï¼ˆAWS EKS, GCP GKE, Azure AKSï¼‰ã«ãƒ‡ãƒ—ãƒ­ã‚¤

### ç™ºå±•çš„ãªãƒˆãƒ”ãƒƒã‚¯

- **CI/CD**: GitHub Actions ã§ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è‡ªå‹•åŒ–
- **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**: Prometheus + Grafana
- **ãƒ­ã‚°é›†ç´„**: ELK Stack (Elasticsearch, Logstash, Kibana)
- **ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥**: Istio, Linkerd
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: Pod Security Policies, Network Policies

---

## ã¾ã¨ã‚

| æŠ€è¡“ | å½¹å‰² | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ |
|------|------|------------|
| **Docker** | ç’°å¢ƒã®æ¨™æº–åŒ– | ã‚¤ãƒ¡ãƒ¼ã‚¸ã€ã‚³ãƒ³ãƒ†ãƒŠã€Dockerfile |
| **Kubernetes** | ã‚³ãƒ³ãƒ†ãƒŠã®è‡ªå‹•ç®¡ç† | Pod, Deployment, Service, HPA |
| **Model-in-Image** | MLãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ã‚¿ãƒ¼ãƒ³ | é«˜é€Ÿèµ·å‹•ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† |

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ**:
- Docker = ã€Œã©ã“ã§ã‚‚å‹•ãç’°å¢ƒã€ã‚’ä½œã‚‹
- Kubernetes = ã€Œè‡ªå‹•ã§é‹ç”¨ã€ã™ã‚‹
- æœ€åˆã¯é›£ã—ãæ„Ÿã˜ã‚‹ãŒã€åŸºæœ¬ã‚’ç†è§£ã™ã‚Œã°å¿œç”¨ãŒåŠ¹ã

---

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [uv ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚¬ã‚¤ãƒ‰](./01_uv_package_manager_guide.md)
- [TDDå®Ÿè·µã‚¬ã‚¤ãƒ‰](./04_test_writing_guide.md)
- [ONNXæ¨è«–ãƒ‘ã‚¿ãƒ¼ãƒ³](./06_onnx_inference_patterns.md)

**æœ€çµ‚æ›´æ–°**: 2025-11-06
