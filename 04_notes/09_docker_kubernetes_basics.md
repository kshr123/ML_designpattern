# Docker & Kubernetes å…¥é–€ã‚¬ã‚¤ãƒ‰

**ä½œæˆæ—¥**: 2025-11-06
**å¯¾è±¡**: Dockerãƒ»Kubernetesåˆå¿ƒè€…
**ç›®çš„**: æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã¨Kubernetesãƒ‡ãƒ—ãƒ­ã‚¤ã®åŸºç¤ã‚’ç†è§£ã™ã‚‹

---

## ğŸ“š ç›®æ¬¡

1. [ãªãœDockerã¨KubernetesãŒå¿…è¦ãªã®ã‹](#ãªãœdockerã¨kubernetesãŒå¿…è¦ãªã®ã‹)
2. [Dockerã®åŸºç¤](#dockerã®åŸºç¤)
3. [Kubernetesã®åŸºç¤](#kubernetesã®åŸºç¤)
4. [å®Ÿè·µï¼šModel-in-Image Pattern](#å®Ÿè·µmodel-in-image-pattern)
5. [ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã¨è§£æ±ºæ–¹æ³•](#ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã¨è§£æ±ºæ–¹æ³•)
6. [æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—](#æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—)

---

## ãªãœDockerã¨KubernetesãŒå¿…è¦ãªã®ã‹

### å¾“æ¥ã®å•é¡Œ

æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹éš›ã®èª²é¡Œï¼š

1. **ç’°å¢ƒã®é•ã„**
   - é–‹ç™ºç’°å¢ƒã§ã¯å‹•ããŒã€æœ¬ç•ªç’°å¢ƒã§å‹•ã‹ãªã„
   - Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä¸ä¸€è‡´
   - ã€Œç§ã®ç’°å¢ƒã§ã¯å‹•ãã®ã«...ã€å•é¡Œ

2. **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®å›°é›£ã•**
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¢—ãˆãŸã‚‰æ‰‹å‹•ã§ã‚µãƒ¼ãƒãƒ¼ã‚’è¿½åŠ 
   - è² è·åˆ†æ•£ã®è¨­å®šãŒè¤‡é›‘
   - éšœå®³æ™‚ã®è‡ªå‹•å¾©æ—§ãŒã§ããªã„

3. **ãƒ‡ãƒ—ãƒ­ã‚¤ã®æ‰‹é–“**
   - ãƒ¢ãƒ‡ãƒ«æ›´æ–°ã®ãŸã³ã«å…¨ã‚µãƒ¼ãƒãƒ¼ã§æ‰‹ä½œæ¥­
   - ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿ
   - ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå›°é›£

### Dockerã¨Kubernetesã§è§£æ±º

- **Docker**: ã€Œã©ã“ã§ã‚‚åŒã˜ã‚ˆã†ã«å‹•ãç’°å¢ƒã€ã‚’ä½œã‚‹
- **Kubernetes**: ã€Œè‡ªå‹•ã§ã‚¹ã‚±ãƒ¼ãƒ«ãƒ»å¾©æ—§ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚’ç®¡ç†

---

## Dockerã®åŸºç¤

### Dockerã¨ã¯

**ã‚³ãƒ³ãƒ†ãƒŠæŠ€è¡“ã‚’ä½¿ã£ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãã®å®Ÿè¡Œç’°å¢ƒã‚’1ã¤ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¾ã¨ã‚ã‚‹ä»•çµ„ã¿**

#### é‡è¦ãªæ¦‚å¿µ

| ç”¨èª | èª¬æ˜ | ä¾‹ãˆ |
|------|------|------|
| **ã‚¤ãƒ¡ãƒ¼ã‚¸** | ã‚¢ãƒ—ãƒªã¨ç’°å¢ƒã®è¨­è¨ˆå›³ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰ | ã‚¯ãƒƒã‚­ãƒ¼ã®å‹ |
| **ã‚³ãƒ³ãƒ†ãƒŠ** | ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ä½œã‚‰ã‚ŒãŸå®Ÿè¡Œç’°å¢ƒ | å‹ã‹ã‚‰ä½œã£ãŸã‚¯ãƒƒã‚­ãƒ¼ |
| **Dockerfile** | ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œã‚Šæ–¹ã‚’æ›¸ã„ãŸãƒ¬ã‚·ãƒ” | æ–™ç†ã®ãƒ¬ã‚·ãƒ” |
| **ãƒ¬ã‚¸ã‚¹ãƒˆãƒª** | ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä¿ç®¡å ´æ‰€ | å›³æ›¸é¤¨ |

### Dockerã®åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

```bash
# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ï¼ˆè¨­è¨ˆå›³ã‚’ä½œã‚‹ï¼‰
docker build -t my-app:v1.0 .

# ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ï¼ˆè¨­è¨ˆå›³ã‹ã‚‰å®Ÿä½“ã‚’ä½œã£ã¦å‹•ã‹ã™ï¼‰
docker run -d --name my-container -p 8000:8000 my-app:v1.0

# èµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¢ºèª
docker ps

# ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ã‚’ç¢ºèª
docker logs my-container

# ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢
docker stop my-container

# ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤
docker rm my-container

# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç¢ºèª
docker images

# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å‰Šé™¤
docker rmi my-app:v1.0
```

### Dockerfileã®åŸºæœ¬æ§‹é€ 

```dockerfile
# ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆåœŸå°ã¨ãªã‚‹OS + è¨€èªç’°å¢ƒï¼‰
FROM python:3.13-slim

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®š
WORKDIR /app

# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
ENV PYTHONUNBUFFERED=1

# ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN apt-get update && apt-get install -y curl

# ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
COPY src/ ./src/

# ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆModel-in-Image Patternï¼‰
COPY models/ ./models/

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆã‚³ãƒ³ãƒ†ãƒŠãŒæ­£å¸¸ã‹ç¢ºèªï¼‰
HEALTHCHECK --interval=30s --timeout=10s \
    CMD curl -f http://localhost:8000/health || exit 1

# å…¬é–‹ã™ã‚‹ãƒãƒ¼ãƒˆ
EXPOSE 8000

# èµ·å‹•ã‚³ãƒãƒ³ãƒ‰
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8000"]
```

### Dockerã®åˆ©ç‚¹

âœ… **å†ç¾æ€§**: åŒã˜Dockerfileã‹ã‚‰åŒã˜ç’°å¢ƒãŒä½œã‚Œã‚‹
âœ… **è»½é‡**: ä»®æƒ³ãƒã‚·ãƒ³ã‚ˆã‚Šèµ·å‹•ãŒé€Ÿãã€ãƒªã‚½ãƒ¼ã‚¹æ¶ˆè²»ãŒå°‘ãªã„
âœ… **åˆ†é›¢**: è¤‡æ•°ã®ã‚¢ãƒ—ãƒªãŒäº’ã„ã«å¹²æ¸‰ã—ãªã„
âœ… **ç§»æ¤æ€§**: é–‹ç™ºâ†’ãƒ†ã‚¹ãƒˆâ†’æœ¬ç•ªã§åŒã˜ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ãˆã‚‹

---

## Kubernetesã®åŸºç¤

### Kubernetesã¨ã¯

**è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’è‡ªå‹•ã§ç®¡ç†ãƒ»é‹ç”¨ã™ã‚‹ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«**

ã€Œã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ©ã®æŒ‡æ®è€…ã€ã®ã‚ˆã†ã«ã€å¤šæ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èª¿æ•´ã—ã¦ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«å‹•ã‹ã™ã€‚

### é‡è¦ãªæ¦‚å¿µ

#### 1. **Podï¼ˆãƒãƒƒãƒ‰ï¼‰**
- Kubernetesã®æœ€å°å˜ä½
- 1ã¤ä»¥ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ã¾ã¨ã‚ãŸã‚‚ã®
- é€šå¸¸1 Pod = 1ã‚³ãƒ³ãƒ†ãƒŠ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Pod       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Containerâ”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. **Deploymentï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆï¼‰**
- Podã®è¨­è¨ˆå›³ã¨ãƒ¬ãƒ—ãƒªã‚«æ•°ã‚’ç®¡ç†
- è‡ªå‹•ã§Podã‚’ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤
- ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼ˆç„¡åœæ­¢ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ï¼‰

```
Deployment
    â”œâ”€ Pod 1 (v1.0)
    â”œâ”€ Pod 2 (v1.0)
    â””â”€ Pod 3 (v1.0)
```

#### 3. **Serviceï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰**
- Podã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆ
- è² è·åˆ†æ•£ï¼ˆãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ï¼‰
- PodãŒå…¥ã‚Œæ›¿ã‚ã£ã¦ã‚‚IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å›ºå®š

```
     Service
        â†“
   Load Balancer
    â”œâ”€â†’ Pod 1
    â”œâ”€â†’ Pod 2
    â””â”€â†’ Pod 3
```

#### 4. **Namespaceï¼ˆãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ï¼‰**
- ãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹è«–ç†çš„ãªåŒºåˆ‡ã‚Š
- ç’°å¢ƒï¼ˆdev, staging, prodï¼‰ã‚„ãƒãƒ¼ãƒ å˜ä½ã§åˆ†ã‘ã‚‹

#### 5. **HPAï¼ˆHorizontal Pod Autoscalerï¼‰**
- è² è·ã«å¿œã˜ã¦Podæ•°ã‚’è‡ªå‹•èª¿æ•´
- CPU/ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ã§åˆ¤æ–­

```
è² è·ãŒé«˜ã„ â†’ Podæ•°ã‚’å¢—ã‚„ã™ï¼ˆã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆï¼‰
è² è·ãŒä½ã„ â†’ Podæ•°ã‚’æ¸›ã‚‰ã™ï¼ˆã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ï¼‰
```

### Kubernetesã®åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’é©ç”¨ï¼ˆãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆãƒ»æ›´æ–°ï¼‰
kubectl apply -f deployment.yml

# ãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèª
kubectl get pods -n my-namespace
kubectl get deployments -n my-namespace
kubectl get services -n my-namespace

# è©³ç´°æƒ…å ±ã‚’ç¢ºèª
kubectl describe pod my-pod -n my-namespace

# ãƒ­ã‚°ã‚’ç¢ºèª
kubectl logs my-pod -n my-namespace

# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
kubectl exec -it my-pod -n my-namespace -- /bin/bash

# ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤
kubectl delete -f deployment.yml
kubectl delete pod my-pod -n my-namespace
```

### ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆYAMLï¼‰

Kubernetesã¸ã®æŒ‡ç¤ºæ›¸ã€‚ä½•ã‚’ã€ã©ã†å‹•ã‹ã™ã‹ã‚’å®£è¨€çš„ã«è¨˜è¿°ã€‚

**ä¾‹: Deployment**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
  namespace: my-namespace
spec:
  replicas: 3  # Podæ•°
  selector:
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
      - name: my-container
        image: my-app:v1.0
        ports:
        - containerPort: 8000
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
```

---

## å®Ÿè·µï¼šModel-in-Image Pattern

### ãƒ‘ã‚¿ãƒ¼ãƒ³æ¦‚è¦

**å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã‚ã¦é…å¸ƒã™ã‚‹æ–¹å¼**

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… ãƒ‡ãƒ—ãƒ­ã‚¤ãŒç°¡å˜ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’Pullã™ã‚‹ã ã‘ï¼‰
- âœ… ãƒ¢ãƒ‡ãƒ«ã¨ã‚³ãƒ¼ãƒ‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸€è‡´
- âœ… é«˜é€Ÿèµ·å‹•ï¼ˆãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸è¦ï¼‰

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ ãƒ¢ãƒ‡ãƒ«æ›´æ–°ã®ãŸã³ã«ã‚¤ãƒ¡ãƒ¼ã‚¸å†ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦
- âŒ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºãŒå¤§ãããªã‚‹
- âŒ è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã®ç®¡ç†ãŒç…©é›‘

### å®Ÿè£…ã®æµã‚Œ

#### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
01_model_in_image/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ model_in_image/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ app.py           # FastAPIã‚¢ãƒ—ãƒª
â”‚       â””â”€â”€ prediction.py    # æ¨è«–ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ iris_svc.onnx        # å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ label.json           # ãƒ©ãƒ™ãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_prediction.py   # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ test_api.py          # çµ±åˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ k8s/
â”‚   â”œâ”€â”€ namespace.yml        # Namespaceå®šç¾©
â”‚   â”œâ”€â”€ deployment.yml       # Deploymentå®šç¾©
â”‚   â”œâ”€â”€ service.yml          # Serviceå®šç¾©
â”‚   â””â”€â”€ hpa.yml              # HPAå®šç¾©
â”œâ”€â”€ Dockerfile               # ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰æ‰‹é †
â”œâ”€â”€ run.sh                   # èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ pyproject.toml           # ä¾å­˜é–¢ä¿‚
â””â”€â”€ SPECIFICATION.md         # ä»•æ§˜æ›¸
```

#### 2. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰

```bash
# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
docker build -t model-in-image-pattern:v1.0 .

# ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆ
docker run -d --name test -p 8000:8000 model-in-image-pattern:v1.0

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8000/health

# æ¨è«–ãƒ†ã‚¹ãƒˆ
curl -X POST http://localhost:8000/predict \
  -H "Content-Type: application/json" \
  -d '{"data": [[5.1, 3.5, 1.4, 0.2]]}'

# ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
docker stop test && docker rm test
```

#### 3. minikubeã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# minikubeèµ·å‹•
minikube start

# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’minikubeã«ãƒ­ãƒ¼ãƒ‰
minikube image load model-in-image-pattern:v1.0

# Namespaceã‚’ä½œæˆ
kubectl apply -f k8s/namespace.yml

# Deploymentã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
kubectl apply -f k8s/deployment.yml

# Serviceã‚’ä½œæˆ
kubectl apply -f k8s/service.yml

# HPAï¼ˆã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼‰ã‚’è¨­å®š
kubectl apply -f k8s/hpa.yml

# çŠ¶æ…‹ã‚’ç¢ºèª
kubectl get all -n model-in-image

# Podã®ãƒ­ã‚°ã‚’ç¢ºèª
kubectl logs -f deployment/model-in-image-deployment -n model-in-image

# ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹
minikube service model-in-image-service -n model-in-image
```

#### 4. å‹•ä½œç¢ºèª

```bash
# minikubeã®IPã¨ãƒãƒ¼ãƒˆã‚’å–å¾—
minikube service model-in-image-service -n model-in-image --url

# ä¾‹: http://192.168.49.2:30080

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://192.168.49.2:30080/health

# ãƒ©ãƒ™ãƒ«å–å¾—
curl http://192.168.49.2:30080/label

# æ¨è«–å®Ÿè¡Œ
curl -X POST http://192.168.49.2:30080/predict \
  -H "Content-Type: application/json" \
  -d '{"data": [[5.1, 3.5, 1.4, 0.2]]}'
```

---

## ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã¨è§£æ±ºæ–¹æ³•

### Dockeré–¢é€£

#### âŒ å•é¡Œ: `ModuleNotFoundError: No module named 'xxx'`

**åŸå› **: Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ‘ã‚¹ãŒé€šã£ã¦ã„ãªã„

**è§£æ±ºç­–**:
```dockerfile
# Dockerfileã«è¿½åŠ 
ENV PYTHONPATH=/app/src
```

#### âŒ å•é¡Œ: ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã‚‹

**è§£æ±ºç­–**:
1. ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã‚’ä½¿ã†
2. `.dockerignore`ã§ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
3. `--no-cache-dir`ã§pipã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤

```dockerfile
# ä¾‹
RUN pip install --no-cache-dir -r requirements.txt
```

#### âŒ å•é¡Œ: ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã™ãçµ‚äº†ã™ã‚‹

**ç¢ºèªæ–¹æ³•**:
```bash
docker logs <container-id>
```

**ã‚ˆãã‚ã‚‹åŸå› **:
- èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã®èª¤ã‚Š
- å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒCOPYã•ã‚Œã¦ã„ãªã„
- ãƒãƒ¼ãƒˆã®è¨­å®šãƒŸã‚¹

### Kubernetesé–¢é€£

#### âŒ å•é¡Œ: Pod ãŒ `ImagePullBackOff` ã‚¨ãƒ©ãƒ¼

**åŸå› **: ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**è§£æ±ºç­–**:
```bash
# minikubeã®å ´åˆ
minikube image load my-image:v1.0

# Deploymentã§æŒ‡å®š
imagePullPolicy: Never  # ãƒ­ãƒ¼ã‚«ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨
```

#### âŒ å•é¡Œ: Pod ãŒ `CrashLoopBackOff`

**åŸå› **: ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ç›´å¾Œã«ã‚¯ãƒ©ãƒƒã‚·ãƒ¥

**ç¢ºèªæ–¹æ³•**:
```bash
kubectl logs <pod-name> -n <namespace>
kubectl describe pod <pod-name> -n <namespace>
```

#### âŒ å•é¡Œ: Service ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„

**ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:
1. Service ã® selector ãŒ Pod ã® label ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹
2. targetPort ãŒæ­£ã—ã„ã‹
3. NetworkPolicy ã§åˆ¶é™ã•ã‚Œã¦ã„ãªã„ã‹

```bash
# Serviceç¢ºèª
kubectl describe service <service-name> -n <namespace>

# EndpointsãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
kubectl get endpoints <service-name> -n <namespace>
```

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹

1. **Docker**
   - å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: https://docs.docker.com/
   - Docker Hub: https://hub.docker.com/

2. **Kubernetes**
   - å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«: https://kubernetes.io/ja/docs/tutorials/
   - Kubernetes By Example: https://kubernetesbyexample.com/

3. **å®Ÿè·µ**
   - æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è©¦ã™
   - æœ¬ç•ªç’°å¢ƒï¼ˆAWS EKS, GCP GKE, Azure AKSï¼‰ã«ãƒ‡ãƒ—ãƒ­ã‚¤

### ç™ºå±•çš„ãªãƒˆãƒ”ãƒƒã‚¯

- **CI/CD**: GitHub Actions ã§ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è‡ªå‹•åŒ–
- **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**: Prometheus + Grafana
- **ãƒ­ã‚°é›†ç´„**: ELK Stack (Elasticsearch, Logstash, Kibana)
- **ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥**: Istio, Linkerd
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: Pod Security Policies, Network Policies

---

## ã¾ã¨ã‚

| æŠ€è¡“ | å½¹å‰² | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ |
|------|------|------------|
| **Docker** | ç’°å¢ƒã®æ¨™æº–åŒ– | ã‚¤ãƒ¡ãƒ¼ã‚¸ã€ã‚³ãƒ³ãƒ†ãƒŠã€Dockerfile |
| **Kubernetes** | ã‚³ãƒ³ãƒ†ãƒŠã®è‡ªå‹•ç®¡ç† | Pod, Deployment, Service, HPA |
| **Model-in-Image** | MLãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ã‚¿ãƒ¼ãƒ³ | é«˜é€Ÿèµ·å‹•ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† |

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ**:
- Docker = ã€Œã©ã“ã§ã‚‚å‹•ãç’°å¢ƒã€ã‚’ä½œã‚‹
- Kubernetes = ã€Œè‡ªå‹•ã§é‹ç”¨ã€ã™ã‚‹
- æœ€åˆã¯é›£ã—ãæ„Ÿã˜ã‚‹ãŒã€åŸºæœ¬ã‚’ç†è§£ã™ã‚Œã°å¿œç”¨ãŒåŠ¹ã

---

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [uv ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚¬ã‚¤ãƒ‰](./01_uv_package_manager_guide.md)
- [TDDå®Ÿè·µã‚¬ã‚¤ãƒ‰](./04_test_writing_guide.md)
- [ONNXæ¨è«–ãƒ‘ã‚¿ãƒ¼ãƒ³](./06_onnx_inference_patterns.md)

**æœ€çµ‚æ›´æ–°**: 2025-11-06
