# ML設計パターン学習プロジェクト - プロジェクト固有ルール

> このファイルは**このプロジェクト固有**のルールです。汎用的な開発ルールは [general_rules.md](./general_rules.md) を参照してください。

---

## 📁 ディレクトリ構造とルール

### ディレクトリの役割

```
.
├── 01_reference/           # 参考リポジトリ（読み取り専用）
├── 02_templates/           # テンプレートファイル
├── 03_my_implementations/  # 自分で実装するコード（書き込み可）
├── 04_notes/               # 学習ノート・メモ（書き込み可）
├── 05_progress/            # 進捗管理（書き込み可）
├── 06_docs/                # ドキュメント
└── 07_tutorials/           # チュートリアル
```

### 重要なルール

#### 1. `01_reference/` は読み取り専用

- 参考リポジトリのコードは変更しない
- 分析や理解のためにのみ参照する
- 必要に応じてコピーして `03_my_implementations/` で改変

#### 2. `03_my_implementations/` に実装する

- ゼロから実装したコードはここに配置
- パターンごとにサブディレクトリを作成
- **ディレクトリ命名規則**: `{NN}_{pattern_name}/` (例: `01_model_db/`, `02_iris_sklearn_svc/`)
- **連番の接頭辞**: フロー順に理解できるように連番（01, 02, 03...）を接頭辞として付ける
- **重要**: Pythonファイル名には連番を付けない（importエラーになるため）
  - ✅ ディレクトリ: `01_model_db/`, `02_iris_sklearn_svc/`
  - ❌ Pythonファイル: `01_data_loader.py`（数字で始まるとimportできない）
  - ✅ Pythonファイル: `data_loader.py`, `model.py`, `trainer.py`

#### 3. `04_notes/` に学習メモを記録

- パターンごとの理解をまとめる
- アーキテクチャ図や設計メモを保存
- **命名規則**: `{NN}_{topic_name}.md`（連番接頭辞を必ず付ける）
- **連番の目的**: フロー順に整理し、学習の流れを明確にする
- **連番の決め方**: 既存の最大番号に1を足した番号を使用
  - 例: 既存が01-07なら、次は `08_{topic_name}.md`
- **作成手順**:
  1. `04_notes/`ディレクトリ内の既存ファイルを確認
  2. 最大の連番を確認（例: 07）
  3. 次の番号で作成（例: 08）
  4. `04_notes/README.md`を更新して新しいガイドを追加
- **例**:
  - ✅ `01_uv_package_manager_guide.md`
  - ✅ `07_one_class_svm_and_anomaly_detection.md`
  - ✅ `08_pytorch_image_classification_guide.md`
  - ❌ `pytorch_image_classification_guide.md`（連番なし）
- **重要**: 新しいガイドを作成したら、必ず`04_notes/README.md`に追加する
  - ガイド一覧に追加
  - 推奨順序に追加
  - トラブルシューティングテーブルに追加
  - 対応表に追加
  - ディレクトリ構造に追加

#### 4. `05_progress/` で進捗を管理

- `learning_log.md` は**進捗の把握のみに使用**
  - どこまで完了したか（チェックリスト）
  - 次にどこから始めるか（次のタスク）
- **詳細な内容は各ディレクトリのREADMEで確認する**
  - 実装の詳細、技術スタック、学習内容は各パターンのREADME.mdに記載
  - learning_log.mdには詳細を書かず、完了日とステータスのみ記録

---

## 💻 このプロジェクト特有のコーディング規約

### Python

- **バージョン**: Python 3.13以上（最新の安定版を使用）
- **パッケージマネージャー**: uv（高速・モダンなパッケージマネージャー）
- **コメントとdocstringの言語**: **必ず日本語で記載すること**
  - ✅ モジュールdocstring: 日本語
  - ✅ 関数/クラスdocstring: 日本語
  - ✅ インラインコメント: 日本語
  - ❌ 英語のコメントは使用しない

#### uvの使い方

```bash
# プロジェクトの初期化
uv init

# 依存関係のインストール
uv pip install <package>

# 仮想環境の作成と有効化
uv venv
source .venv/bin/activate  # macOS/Linux

# pyproject.tomlから依存関係をインストール
uv pip install -r pyproject.toml

# 依存関係のロック
uv pip freeze > requirements.txt
```

### YAML

- **コメント**: **必ず日本語で詳細なコメントを記載すること**
  - ✅ ファイル冒頭にヘッダーコメント（役割と目的を説明）
  - ✅ 各セクションにコメント（何を設定しているか説明）
  - ✅ 重要な設定項目には inline コメント
  - ✅ 初見の人が理解できるレベルの説明
- **対象ファイル**:
  - Kubernetes設定ファイル（deployment.yml, service.yml, hpa.yml等）
  - Docker Compose設定ファイル
  - CI/CD設定ファイル（GitHub Actions等）

#### YAMLコメントの例

```yaml
# ==============================================================================
# Deployment定義 - Model-Load Pattern
# ==============================================================================
# このファイルの役割と目的を説明
# ==============================================================================

apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
  namespace: my-namespace  # どの名前空間に属するか

spec:
  # レプリカ数（Pod数）
  replicas: 2  # 2つのPodを起動

  # 環境変数
  env:
    - name: MODEL_FILEPATH
      value: "/workdir/models/model.onnx"  # モデルファイルのパス
```

### ファイル構成

各実装には以下を含める：

#### 必須ファイル

- `SPECIFICATION.md` - **仕様書**（要件、アーキテクチャ、API設計）
- `README.md` - 実装の説明、セットアップ手順、実行方法
  - **重要**: チャプター（章）のREADMEと個別パターンのREADMEは役割が異なる
    - **チャプターREADME**: 章全体の概要、他の章との違い、パターン一覧（簡潔に）
    - **パターンREADME**: 個別実装の詳細、技術スタック、セットアップ、学んだこと（詳細に）
- `pyproject.toml` - プロジェクトメタデータと依存関係（uvで管理）
- `tests/` - テストコード（テスト駆動開発）
  - `test_unit.py` - ユニットテスト
  - `test_integration.py` - 統合テスト
  - `test_e2e.py` - E2Eテスト（必要に応じて）

#### 自動生成ファイル

- `uv.lock` - 依存関係のロックファイル（uvが自動生成）

#### オプションファイル

- `.python-version` - Pythonバージョンの指定
- `docker-compose.yml` - Docker環境
- `Makefile` - よく使うコマンドのショートカット
- `.env.example` - 環境変数のサンプル

---

## 📝 README.md の記載内容（プロジェクト固有）

### チャプター（章）のREADME - 概要のみ

```markdown
# Chapter N: {章名}

## 🎯 この章で学ぶこと

- 学習テーマ1
- 学習テーマ2

## 📖 他の章との違い

| 章        | 焦点 | 主なトピック |
| --------- | ---- | ------------ |
| Chapter N | ...  | ...          |

## 📚 実装パターン一覧

| #   | パターン名 | 内容 | 難易度 | 状態 |
| --- | ---------- | ---- | ------ | ---- |

## 🎓 学習の推奨順序

[簡潔なフロー図]

## 🔗 関連ドキュメント

[リンク集]

**詳細は各パターンのREADME.mdを参照してください。**
```

### パターン（個別実装）のREADME - 詳細を記載

```markdown
# {パターン名}

## 概要

このパターンの目的と解決する課題

## アーキテクチャ

システム構成図や説明

## 技術スタック

使用したライブラリとツール

## セットアップ

環境構築手順

## 実行方法

実際の実行コマンドとその説明

## テスト

テストの実行方法

## 学んだこと

実装を通して得た知見（詳細に）

## 参考

- [SPECIFICATION.md](./SPECIFICATION.md)
- [元のコード](../../../01_reference/...)
```

---

## 🔧 実装時の注意事項（機械学習特有）

### 機械学習特有の注意点

- **モデル管理**: モデルファイルのバージョン管理（DVC等の利用を検討）
- **再現性**: random seedの固定、環境の明示
- **データ**: サンプルデータはgitにコミットせず、ダウンロードスクリプトを用意
- **評価**: 学習と推論のメトリクスを明確に記録

### データセットファイルの管理（重要）⚠️

**大容量データはGitにプッシュしない**

GitHubの制限（100MB）を超えるファイルはプッシュできません。以下のルールを厳守してください。

#### 禁止事項

❌ **以下のファイルをGitにコミット・プッシュしない**:

- データセットの圧縮ファイル（\*.tar.gz, \*.zip, \*.tar, \*.7z, \*.rar）
- 大容量データセット（CIFAR-10, ImageNet, MNIST等）
- 展開済みのデータセットディレクトリ

#### 推奨方法

✅ **データセットの正しい管理方法**:

1. **ダウンロードスクリプトを作成**

   ```python
   # download_data.py
   import urllib.request
   import tarfile

   def download_cifar10():
       """CIFAR-10データセットをダウンロードして展開する"""
       url = "https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz"
       filename = "cifar-10-python.tar.gz"

       print("Downloading CIFAR-10...")
       urllib.request.urlretrieve(url, filename)

       print("Extracting...")
       with tarfile.open(filename, "r:gz") as tar:
           tar.extractall()

       print("Done!")

   if __name__ == "__main__":
       download_cifar10()
   ```

2. **README.mdに記載**

   ````markdown
   ## データセットのセットアップ

   CIFAR-10データセットをダウンロードして展開します：

   ```bash
   python download_data.py
   ```

   または手動でダウンロード：

   ```bash
   wget https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz
   tar -xzf cifar-10-python.tar.gz
   ```
   ````

3. **.gitignoreに追加** （すでに設定済み）
   ```gitignore
   # Large dataset files (>100MB GitHub limit)
   *.tar.gz
   *.zip
   cifar-10-batches-py/
   test_data/
   data/raw/
   datasets/
   ```

#### もしプッシュしてしまったら

1. **Git履歴から削除**

   ```bash
   git rm --cached <large-file>
   git commit --amend --no-edit
   git push --force
   ```

2. **.gitignoreに追加**して再発防止

---

## 📊 進捗管理

### progress/learning_log.md の役割

**重要**: `progress/learning_log.md` は**進捗把握専用**です。詳細な内容は書きません。

**記載内容**:

- ✅ どこまで完了したか（チェックリスト）
- ✅ 次にどこから始めるか（次のタスク）
- ✅ 完了日のみ（例: `2025-11-05`）
- ❌ 学習内容の詳細（各READMEで確認）
- ❌ 実装の詳細（パターンのREADMEで確認）
- ❌ 技術スタック（パターンのREADMEで確認）

### ドキュメント更新フロー（必須）

**各チュートリアル完了後は必ず以下の順序でドキュメントを更新すること**:

1. **パターンのREADME.md**

   - 実装の詳細、技術スタック、学習内容を詳しく記載
   - 他の人が見てもわかるように丁寧に書く

2. **チャプターのREADME.md**

   - そのチャプター内の進捗状況を更新
   - 完了したパターンの概要を追加

3. **プロジェクトルートのREADME.md**

   - 全体の完了パターン数を更新
   - 完了したパターンのリストを更新

4. **progress/learning_log.md**
   - 完了日とステータスのみ記録
   - 詳細は書かない

### 必須タスク

- [ ] 各パターン学習開始時: `progress/learning_log.md` にチェックボックスを追加
- [ ] 実装完了時: **4段階のドキュメント更新**を実施
  1. パターンのREADME.md（詳細）
  2. チャプターのREADME.md（チャプター進捗）
  3. プロジェクトのREADME.md（全体進捗）
  4. learning_log.md（完了日のみ）
- [ ] Git操作: 変更をコミット・プッシュ

### 推奨タスク

- 重要な発見や気づきはパターンのREADMEに記載
- 躓いた点とその解決方法をパターンのREADMEに記録
- パターン間の関連性や組み合わせ方をチャプターのREADMEに記載

---

## 🎓 学習の優先順位

### 推奨学習順序

1. **Chapter 2: Training** - 基礎となるモデル学習
2. **Chapter 3: Release Patterns** - モデルのリリース方法
3. **Chapter 4: Serving Patterns** - 推論サービスの実装（最重要）
4. **Chapter 5: Operations** - 運用とモニタリング
5. **Chapter 6: Operation Management** - 高度な運用管理

ただし、興味のある分野から始めてもOK。モチベーション維持が最優先。

---

## 🤝 Claude Codeとの協働ルール（プロジェクト固有）

### このプロジェクトで Claude Code に期待すること

1. **コード分析**: 参考コード（01_reference/）の詳細な説明
2. **設計支援**: アーキテクチャの提案と議論
3. **実装サポート**: ゼロからのコーディング支援（03_my_implementations/）
4. **レビュー**: 実装したコードの改善提案
5. **トラブルシューティング**: エラーの解決支援
6. **ドキュメント作成**: README等の作成補助

### Claude Code が守るべきこと（プロジェクト固有）

1. **ドキュメント更新**: 各チュートリアル完了後、**必ず4段階のドキュメント更新**を実施する
   - パターンのREADME.md → チャプターのREADME.md → プロジェクトのREADME.md → learning_log.md
2. **命名規則**:
   - パターンディレクトリには連番を接頭辞として付ける（01\_, 02\_, 03\_...）
   - Pythonファイル名には連番を付けない（importエラーを回避）
3. **ノートファイル作成時の手順**:
   - 新しいガイドを`04_notes/`に作成する際は、**必ず連番接頭辞を付ける**
   - 作成手順:
     1. `04_notes/`ディレクトリ内の既存ファイルを確認
     2. 最大の連番を確認（例: 07）
     3. 次の番号でファイルを作成（例: `08_pytorch_image_classification_guide.md`）
     4. `04_notes/README.md`を更新（ガイド一覧、推奨順序、対応表、ディレクトリ構造に追加）
   - **連番なしでファイルを作成した場合は、即座にリネームする**
4. **YAMLファイルのコメント**:
   - **すべてのYAMLファイルに日本語で詳細なコメントを記載すること**
   - ファイル冒頭にヘッダーコメント（役割と目的）
   - 各セクションにコメント（何を設定しているか）
   - 重要な設定項目には inline コメント
   - 初見の人が理解できるレベルの説明を心がける
   - 対象: Kubernetes設定、Docker Compose、CI/CD設定など
5. **チュートリアル実施時のルール**:
   - **ガイド役に徹する**: ユーザーが手を動かして学ぶため、コマンドを代わりに実行しない
   - **指示とヒントを提供**: 次に何をすべきか、どのコマンドを実行すべきかを説明する
   - **期待される出力を先に示す**:
     - ❌ 「結果を教えてください」と聞く → ユーザーが何が正しいか分からない
     - ✅ 「期待される出力: XXX」を先に示す → ユーザーが自分で確認できる
     - 例:
       ```
       期待される出力:
       ```
       host: Running
       kubelet: Running
       apiserver: Running
       ```

       上記のコマンドを実行してください。すべて `Running` なら正常です。
       ```
   - **全体の流れを示す**: 次のステップもざっくり示して、全体感を損なわないようにする
     - 例:
       ```
       Step 4.4: Deployment作成 ← 今ここ
         ↓
       Step 4.5: Deployment確認
         ↓
       Step 4.6: Service作成
         ↓
       Step 5: APIテスト
       ```
   - **コマンド実行後の自動確認と次ステップへの自動遷移**:
     - ユーザーが `!command` を実行すると、出力が Caveat として届く
     - Caveat の出力を確認して、期待される結果と照合する
     - ✅ 問題なし → 「✅ 成功」と確認メッセージを出して、**自動的に次のステップに進む**
     - ❌ エラー → エラー内容を説明して、解決策を提示する
     - **重要**: ユーザーに「OK」などの確認を求めない。自動で次に進む。
     - **例外 - 継続的に出力されるコマンド**:
       - `-w` (watch), `-f` (follow), `tail -f` など、継続的に出力されるコマンドは Caveat として届かない
       - **このようなコマンドの場合、事前にガイドで明示的に説明する**:
         ```
         **注意**: このコマンドは継続的に出力されるため、自動確認できません。
         `Running` になったら **Ctrl + C** で終了して、次のステップに進んでください。
         ```
   - **確認とフィードバック**: ユーザーが実行した結果を確認し、次のステップを提示する
   - **エラー時のサポート**: エラーが出た場合は原因と解決方法を説明する
   - **実装開発とチュートリアルの区別**:
     - 実装開発（新規パターン実装）: Claude Codeがコードを書く
     - チュートリアル（ハンズオン、練習）: ユーザーがコマンドを実行、Claude Codeはガイドのみ
   - **例外**: ユーザーが明示的に「代わりにやって」と依頼した場合のみコマンドを実行

### Claude Codeへの指示例

#### 良い指示（仕様駆動 + TDD）:

**フェーズ1: 理解**

- "synchronous_patternの参考コードを分析して、要件とアーキテクチャを説明して"
- "このパターンが解決する課題とユースケースを教えて"

**フェーズ2: 仕様策定**

- "同期推論パターンのSPECIFICATION.mdを作成して。要件定義から始めて"
- "API仕様を詳細に定義して。エンドポイント、入出力、エラーレスポンスを含めて"

**フェーズ3: テスト作成**

- "仕様書に基づいてユニットテストを作成して。まず失敗するテストから"
- "統合テストのテストケースを追加して"

**フェーズ4: 実装**

- "最初のテストを通すための最小限の実装をして"
- "次の機能を実装して、テストを段階的にGreenにして"

**フェーズ5: リファクタリング**

- "実装をレビューして、改善点を提案して"
- "パフォーマンスを最適化して、テストが通ることを確認して"

**フェーズ6: 検証**

- "実装したコードを実際に動かして動作確認して"
- "エラーケースのハンドリングを確認して"

#### 悪い指示：

- "参考コードをそのままコピーして" ← 学習にならない
- "全部一気に実装して" ← TDDサイクルを無視
- "テストは後で書く" ← テスト駆動開発ではない
- "仕様書は不要" ← 仕様駆動開発ではない

---

**最終更新**: 2025-11-13
